/*! FunnelQL v1.0.5
 * (c) https://funnelql.com/ */
!function(p,y){function l(){}function z(a){var b;return b||(b=A),b.querySelector(a)}function B(a){a=t.indexOf(a);-1!==a&&t.splice(a,1)}function C(a,b,e,d,c){this.constructor.prototype.__proto__=SyntaxError.prototype;SyntaxError.captureStackTrace&&SyntaxError.captureStackTrace(this,this.constructor);this.name="FunnelQL_Error";this.message=a;this.startLine=b;this.startCol=e;this.endLine=d;this.endCol=c;this.toObject=function(){return[1,this.message,this.startLine,this.startCol,this.endLine,this.endCol]}}
function r(a,b,e){var d=++G;h.b(d,b);w.postMessage([a,d,e])}function D(a){return new Promise(function(b){x.href=a;r(2,function(a){b(a);h.c("path",a)},a=x.pathname+x.search)})}if("Promise"in p){var A=p.document;Date.now||(Date.now=function(){return(new Date).getTime()});var h=new (function(a){function b(){}function e(a,b,d){this.fn=a;this.context=b;this.b=d||!1}function d(){this.a=new b;this.f=0}return Object.create&&(b.prototype=Object.create(null),(new b).__proto__||(a=!1)),d.prototype.c=function(c,
b,d,e,k,h){var g=a?a+c:c;if(!this.a[g])return!1;var m,f=this.a[g],n=arguments.length;if(f.fn){switch(f.b&&this.removeListener(c,f.fn,y,!0),n){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,b),!0;case 3:return f.fn.call(f.context,b,d),!0;case 4:return f.fn.call(f.context,b,d,e),!0;case 5:return f.fn.call(f.context,b,d,e,k),!0;case 6:return f.fn.call(f.context,b,d,e,k,h),!0}g=1;for(m=Array(n-1);g<n;g++)m[g-1]=arguments[g];f.fn.apply(f.context,m)}else for(var l,H=f.length,g=
0;g<H;g++)switch(f[g].b&&this.removeListener(c,f[g].fn,y,!0),n){case 1:f[g].fn.call(f[g].context);break;case 2:f[g].fn.call(f[g].context,b);break;case 3:f[g].fn.call(f[g].context,b,d);break;case 4:f[g].fn.call(f[g].context,b,d,e);break;default:if(!m)for(l=1,m=Array(n-1);l<n;l++)m[l-1]=arguments[l];f[g].fn.apply(f[g].context,m)}return!0},d.prototype.on=function(c,b,d){b=new e(b,d||this);c=a?a+c:c;return this.a[c]?this.a[c].fn?this.a[c]=[this.a[c],b]:this.a[c].push(b):(this.a[c]=b,this.f++),this},d.prototype.b=
function(c,b,d){b=new e(b,d||this,!0);c=a?a+c:c;return this.a[c]?this.a[c].fn?this.a[c]=[this.a[c],b]:this.a[c].push(b):(this.a[c]=b,this.f++),this},d.prototype.removeListener=function(c,d,e,h){c=a?a+c:c;if(!this.a[c])return this;if(!d)return 0==--this.f?this.a=new b:delete this.a[c],this;var k=this.a[c];if(k.fn)k.fn!==d||h&&!k.b||e&&k.context!==e||(0==--this.f?this.a=new b:delete this.a[c]);else{for(var m=0,g=[],l=k.length;m<l;m++)(k[m].fn!==d||h&&!k[m].b||e&&k[m].context!==e)&&g.push(k[m]);g.length?
this.a[c]=1===g.length?g[0]:g:0==--this.f?this.a=new b:delete this.a[c]}return this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.h=a,d}("~")),t=[];h.on("u",function(){!function(a){isNaN(a)&&(a=!1);for(var b=t.length,e=0;e<b;e++)!1!==a&&e!==a||function(a,b){l.query(b).then(function(c){c&&(h.c("q"+a,c,b),B(b))})}(e,t[e])}()});for(var q=0;64>q;)++q;var u,E,w,v,F=function(a,b){var e="blue",d="#dfdfdf";switch(b){case "info":e="#afafaf";break;case "error":d=e="red";
break;case "warn":d=e="orange"}a.unshift("font-size:12px;font-weight:bold;color:"+d+";margin-right:1px;");a.unshift("font-size:8px;font-weight:bold;");a.unshift("font-size:12px;font-weight:bold;color:"+e+";margin-right:1px;");a.unshift("font-size:12px;font-weight:bold;color:"+d+";margin-right:1px;");a.unshift("%c\u2772%c\u0192%cQL%c\u2773");console.log.apply(null,a)},G=(p.performance,0),q=p["funnelql-worker"];if(!q){q=A.currentScript||z('script[src*="/funnelql.js"]')||z('script[src*="/funnelql.nodebug"]');
if(!q)throw Error("Failed to detect funnelql.js script element. Define path to funnelql-worker.js on window['funnelql-worker'].");q=q.src.replace(/\/funnelql\.(js|nodebug)/,"/funnelql-worker.$1")}(w=new Worker(q)).addEventListener("message",function(a){a.data&&a.data[0]&&h.c(a.data[0],a.data[1],a.data[2])});w.addEventListener("error",function(a){console.error("FunnelQL Worker:",a)});h.on("fn",function(a){function b(a){r(6,function(){},[m,a])}var e,d=a[0],c=a[1]||[];a[2]&&c.push(a[2]);var m=a[3];try{if(-1!==
d.indexOf(".")){a=p;for(var h=dotFn.split("."),l=h.pop(),d=0;d<h.length;d++)a=a[h[d]];e=a[l].apply(p,c)}else{if(!p[d])throw Error(d+" is not a function");e=p[d].apply(p,c)}e instanceof Promise?e.then(function(a){b(a)}):b(e)}catch(k){u&&F(["function query failed",k],"error"),b(!1)}});var x=document.createElement("a");h.on("load",function(){D(document.location.toString()).then(function(a){v=a})});l.init=function(a){return function(a){if("object"!=typeof a)throw Error("Invalid config.");a.g||(a.g="session");
var b=[];"session"===a.g?b[0]=!!sessionStorage.getItem("funnelql"):"never"===a.g?b[0]=!0:b[0]=a.g;r(1,function(){E=1;h.c("load");"session"===a.g&&sessionStorage.setItem("funnelql",1)},b)}(a),this};l.parse=function(a){return new Promise(function(b,e){r(9,function(a,c){c?e(new C(c[1],c[2],c[3],c[4],c[5])):b(a)},a)})};l.query=function(a){return new Promise(function(b,e){r(8,function(a,c){c?e(new C(c[1])):b(a)},a)})};l.tag=function(a,b){return new Promise(function(e){(v?Promise.resolve(v):new Promise(function(a){h.b("path",
function(b){a(v=b)})})).then(function(d){r(3,function(){h.c("u");e()},[a,d,b])})})};l.nav=D;l.db=function(a){h.on("load",function(){r(7,a)})};l.on=function(a,b){return function d(a,b,n){var c=[];switch(a){case "load":if(E)return b?b():Promise.resolve(void 0);break;default:var k=a;if(k instanceof Array){if(!b)throw Error("Cannot use multi-query with a promise. Use a callback.");return void k.forEach(function(a){d(a.toString(),b)})}var m=t.indexOf(k);-1===m&&(m=t.push(k)-1);c.push([function(a,b){l.query(b).then(function(c){c&&
(h.c(a,c,b),B(b))})},k]);a="q"+m}if(n=b?(n?h.on(a,b):h.b(a,b),this):new Promise(function(b){h.b(a,b)}),c.length)for(k=c.shift();k;)k[0].apply(this,[a].concat(k[1])),k=c.shift();return n}(a,b)};l.off=function(a,b){switch(a){case "load":h.off(a,b);break;default:var e=t.indexOf(a);-1!==e&&h.off("q"+e,b)}return this};l.debug=function(a){u!==(a=!!a)&&((u=a)&&F(["debug enabled"],"warn"),r(5,function(){},u))};window.$FQL=l}else console.error("FunnelQL is not supported by your browser.")}(window);
